% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_curve.R
\name{fit_curve}
\alias{fit_curve}
\title{Fit a curve to longitudinal data}
\usage{
fit_curve(
  data,
  x,
  t,
  model = x ~ 1,
  t_prefix = NULL,
  t_suffix = NULL,
  keep_model = TRUE
)
}
\arguments{
\item{data}{A data.frame in long format containing at least the measurement
and time columns.}

\item{x}{The measurement column. May be a bare name, a single string column
name, or a single integer column index. Defaults to the first column of
\code{data} if not supplied.}

\item{t}{The time column. May be a bare name, a single string column name, or
a single integer column index. Defaults to the second column of \code{data} if
not supplied.}

\item{model}{A model formula to be fit with \code{stats::lm()}. The model may refer
to canonical names (\code{x}, \code{t}) or to the original column names identified by
\code{x} and \code{t}. Default is \code{x ~ 1}.}

\item{t_prefix}{Optional string to strip from the start of \code{t} values prior to
numeric coercion.}

\item{t_suffix}{Optional string to strip from the end of \code{t} values prior to
numeric coercion.}

\item{keep_model}{Logical; if \code{TRUE} (default), the fitted \code{lm} object is
retained in the result as \code{model_object}. If \code{FALSE}, \code{model_object} is
\code{NULL} to reduce object size.}
}
\value{
An object of class \code{"fit_curve"}, a list containing:
\itemize{
\item \code{model_input}: the model formula provided by the user.
\item \code{model}: the canonical model formula actually fitted (in terms of \code{x} and \code{t}).
\item \code{x}: metadata about the measurement column (\code{col}, \code{type}).
\item \code{t}: metadata about the time column (\code{col}, \code{type}, \code{prefix}, \code{suffix}).
\item \code{coefficients}: a data.frame of coefficient estimates and p-values.
\item \code{fit}: a list of fit statistics (\code{n}, \code{r.squared}, \code{adj.r.squared},
\code{rse}, \code{rmse}, \code{df_resid}, \code{rss}, \code{aic}, \code{bic}, \code{logLik}).
\item \code{F}: a list describing the model F-test (\code{statistic}, \code{df1}, \code{df2},
\code{p.value}), or \code{NA} values if unavailable.
\item \code{model_object}: the fitted \code{lm} object (or \code{NULL} if \code{keep_model = FALSE}).
}
}
\description{
\code{fit_curve()} is a low-level workhorse used by \strong{timefitteR} to fit a specified
model formula to long-format longitudinal data. It prepares a local modelling
data set containing numeric \code{x} (the measurement) and numeric \code{t} (time),
removes incomplete cases, standardises the model formula to canonical variable
names (\code{x} and \code{t}), and fits the model using \code{stats::lm()}.

The returned object contains common fit statistics (e.g., R-squared, RMSE,
AIC/BIC) and coefficient estimates with p-values, enabling downstream
decisions about whether a candidate curve is an adequate fit.
}
\details{
Column references for \code{x} and \code{t} may be supplied as bare names (tidyverse
style), single strings, or single integer column indices. If omitted, \code{x} and
\code{t} default to the first and second columns of \code{data}, respectively.

The time column \code{t} is coerced to numeric using an internal coercion helper,
optionally stripping \code{t_prefix} and/or \code{t_suffix} prior to conversion.

Rows with missing values in \code{x} or \code{t} are removed prior to model fitting. If
any rows are dropped, an informational message is emitted. If no complete
cases remain, the function errors.

The model formula may be written using canonical names (\code{x}, \code{t}) or the
original column names supplied via \code{x} and \code{t}. The left-hand side of the
model must be the response variable (\code{x}, or the column mapped to \code{x}); left-
hand side transformations (e.g., \code{x^2 ~ t}) are not permitted.
}
\examples{
df <- data.frame(
  time  = rep(1:5, 10),
  score = rnorm(50) + rep(1:5, 10)
)

# bare names
fit_curve(df, x = score, t = time, model = x ~ t)

# string column names
fit_curve(df, x = "score", t = "time", model = score ~ time)

# integer indices (x = 2nd col, t = 1st col)
fit_curve(df, x = 2, t = 1, model = x ~ t)

# constant model
fit_curve(df, x = score, t = time, model = x ~ 1, keep_model = FALSE)
}
